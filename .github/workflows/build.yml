name: Builds

on:
  push:
  pull_request:
    branches:
      - master
      - 'release/**'

env:
  CTEST_OUTPUT_ON_FAILURE: 1
  HOMEBREW_NO_INSTALL_CLEANUP: 1

jobs:
  # linux:
  #   runs-on: ubuntu-latest
  #   env: {}
  #   steps:
  #     - uses: actions/checkout@v2

  macos:
    runs-on: macos-10.15
    env:
      HOMEBREW_NO_INSTALL_CLEANUP: 1
    steps:
      - uses: actions/checkout@v2
      - name: Cache multiple paths
        uses: actions/cache@v2
        with:
          path: |
            /Users/runner/.cache/vcpkg/archives/
          key: ${{ runner.os }}
      - name: Install dependencies
        run: >
          brew install ninja
          && vcpkg install glm glfw3 sol2 fmt lua[cpp] entt nlohmann-json
      - name: Configure
        run: >
          ls /usr/local/share/vcpkg
          && ls /usr/local/share/vcpkg/scripts
          && ls /usr/local/share/vcpkg/scripts/buildsystems
          && mkdir build 
          && cmake .
              -B build
              -GNinja 
              -DVCPKG_TARGET_TRIPLET=x64-osx
              -DCMAKE_TOOLCHAIN_FILE=/usr/local/share/vcpkg/scripts/buildsystems/vcpkg.cmake
      - name:
        working-directory: build
        run: >
          ninja